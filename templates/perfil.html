<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mi Perfil | AgroMarket</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/perfil_usuario.css') }}">
</head>
<body>
<header>
    <nav class="menu">
        <ul>
            <li class="logo">AgroMarket</li>
            <li><a href="{{ url_for('auth.perfil') }}" class="active">Mi Perfil</a></li>
            <li class="user-name">Hola, {{ usuario.nombre }}</li>
            <li class="logout"><a href="{{ url_for('auth.logout') }}">Cerrar Sesión</a></li>
        </ul>
    </nav>
</header>

<main class="perfil-container">
    <h1>Mi Perfil</h1>

    <!-- Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Formulario de perfil -->
    <form method="POST" class="perfil-form">
        <div class="form-group">
            <label>Nombre:</label>
            <input type="text" name="nombre" value="{{ usuario.nombre }}" required>
        </div>

        <div class="form-group">
            <label>Email:</label>
            <input type="email" name="email" value="{{ usuario.email }}" required>
        </div>

        <div class="form-group">
            <label>Contraseña nueva:</label>
            <input type="password" name="password">
        </div>

        <div class="form-group">
            <label>Confirmar contraseña:</label>
            <input type="password" name="password_confirm">
        </div>

        <!-- Rol activo -->
        <div class="form-group">
            <label>Rol activo:</label>
            <select name="rol_activo">
                {% for r in roles %}
                    <option value="{{ r }}" {% if r == rol_activo %}selected{% endif %}>{{ r.capitalize() }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="btn">Actualizar Perfil</button>
    </form>

    <!-- Botones para activar roles adicionales -->
    <div class="roles-container">
        <h3>Activar un nuevo rol:</h3>
        {% set todos_los_roles = ['vendedor', 'comprador'] %}
        {% for r in todos_los_roles %}
            <form method="POST" action="{{ url_for('auth.perfil') }}">
                <input type="hidden" name="nuevo_rol" value="{{ r }}">
                <button type="submit" {% if r in roles %}disabled{% endif %}>
                    {% if r in roles %}
                        Rol {{ r.capitalize() }} activo ✔
                    {% else %}
                        Activar rol {{ r.capitalize() }}
                    {% endif %}
                </button>
            </form>
        {% endfor %}
    </div>
</main>
</body>
</html>
