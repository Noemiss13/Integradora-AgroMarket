<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Producto - AgroMarket</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos_vendedor.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/formulario_productos.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- PWA: Manifest y theme color -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#2e8b57">

    <!-- Iconos -->
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='images/icons/icons-192.png') }}">
    <link rel="apple-touch-icon" sizes="512x512" href="{{ url_for('static', filename='images/icons/icons-512.png') }}">
</head>
<body>
<nav>
    <div class="nav-left">
        <div class="logo"><h2>AgroMarket</h2></div>
        <div class="saludo-usuario">Hola, <strong>{{ nombre }}</strong></div>
    </div>
    <div class="menu">
        <a href="{{ url_for('vendedor.panel_vendedor') }}">Home</a>
        <a href="{{ url_for('vendedor.agregar_producto') }}" class="activo">Agregar Productos</a>
        <a href="{{ url_for('vendedor.productos') }}">Mis Productos</a>
        <a href="{{ url_for('vendedor.ventas') }}">Ventas</a>
        <a href="{{ url_for('auth.perfil') }}">Mi Perfil</a>
        <a href="{{ url_for('auth.logout') }}">Cerrar Sesi√≥n</a>
    </div>
</nav>

<main>
    <h1>Agregar Producto</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <div class="product-form-container">
        <div class="form-column">
            <form action="{{ url_for('vendedor.agregar_producto') }}" method="POST" enctype="multipart/form-data" id="productForm">
                <div class="form-group">
                    <label for="nombre">Nombre del producto:</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Ej: Manzanas rojas" required>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripci√≥n:</label>
                    <textarea id="descripcion" name="descripcion" placeholder="Describe tu producto, origen, caracter√≠sticas especiales, etc." required></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria">Categor√≠a:</label>
                        <select id="categoria" name="categoria" required>
                            <option value="">--Selecciona una--</option>
                            <option value="frutas">Frutas</option>
                            <option value="verduras">Verduras</option>
                            <option value="semillas">Semillas</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="unidad">Unidad m√≠nima:</label>
                        <select id="unidad" name="unidad" required>
                            <option value="kg">kg</option>
                            <option value="reja">Reja</option>
                            <option value="tonelada">Tonelada</option>
                        </select>
                        <div id="unidad-mensaje" class="unidad-mensaje" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>M√≠nimo 5 kg por unidad</span>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio">Precio (MXN):</label>
                        <input type="number" id="precio" name="precio" min="0" step="0.01" placeholder="25.50" required>
                    </div>
                    <div class="form-group">
                        <label for="stock">Cantidad disponible:</label>
                        <input type="number" id="stock" name="stock" min="1" step="1" placeholder="100" required>
                        <div id="stock-mensaje" class="stock-mensaje" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>M√≠nimo 5 unidades</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Imagen del producto:</label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <input type="file" id="imagen" name="imagen" accept="image/*" class="file-input" aria-label="Seleccionar imagen del producto" required>
                        <div class="file-upload-content">
                            <div class="file-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="file-upload-text">Haz clic para subir una imagen</div>
                            <div class="file-upload-subtext">o arrastra y suelta una imagen aqu√≠</div>
                        </div>
                    </div>
                    <div id="imagePreview" class="image-preview" style="display: none;">
                        <img id="previewImg" src="" alt="Vista previa de la imagen">
                        <button type="button" id="removeImage" class="remove-image-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-upload"></i> Publicar Producto
                </button>
            </form>
        </div>
    </div>
</main>

<!-- PWA Service Worker -->
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("{{ url_for('static', filename='js/service-worker.js') }}")
    .then(reg => console.log("‚úÖ Service Worker registrado:", reg))
    .catch(err => console.error("‚ùå Error al registrar SW:", err));
  }
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Detectar si estamos offline
    if (!navigator.onLine) {
      console.log("‚ö†Ô∏è Modo offline activo");

      // Deshabilitar enlaces de registro y login
      const restrictedLinks = [
        "a[href*='/auth/register']",
        "a[href*='/auth/login']",
        "a[href*='/vendedor/agregar_producto']",
        "a[href*='/vendedor/editar_producto']",
        "a[href*='/vendedor/editar_perfil']"
      ];

      restrictedLinks.forEach(selector => {
        document.querySelectorAll(selector).forEach(el => {
          el.classList.add("offline-disabled"); // clase para estilo opcional
          el.addEventListener("click", function(e) {
            e.preventDefault(); // bloquea navegaci√≥n
            alert("üö´ Esta acci√≥n no est√° disponible en modo offline.");
          });
        });
      });

      // Deshabilitar formularios sensibles
      const restrictedForms = [
        "form[action*='/auth/register']",
        "form[action*='/auth/login']",
        "form[action*='/vendedor/agregar_producto']",
        "form[action*='/vendedor/editar_producto']"
      ];

      restrictedForms.forEach(selector => {
        document.querySelectorAll(selector).forEach(form => {
          form.addEventListener("submit", function(e) {
            e.preventDefault();
            alert("üö´ No puedes enviar este formulario en modo offline.");
          });
        });
      });
    }
  });
</script>

<style>
  /* Opcional: indicar visualmente los enlaces deshabilitados */
  .offline-disabled {
    pointer-events: none;
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

</body>
</html>